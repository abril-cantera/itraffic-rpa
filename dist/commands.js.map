{"version":3,"file":"commands.js","mappings":"mBAIAA,OAAOC,QAAQ,KACbC,QAAQC,IAAI,wBAmIbH,OAAOI,QAAgBC,UAAU,eA7HlC,SAAsBC,GACpBN,OAAOO,MAAMC,iBACbF,EAAMG,WACR,GA2HCT,OAAOI,QAAgBC,UAAU,cAtHlCK,eAA2BJ,GACzB,IAEE,MAAMK,EAAUX,OAAOY,QAAQD,QAClBA,EAAQE,MAInBF,EAAQE,MAAMC,qBAAqBC,SAAS,eAAgB,CAC1DC,KAAMhB,OAAOiB,aAAaC,4BAA4BC,qBACtDC,QAAS,+BACTC,KAAM,UACNC,YAAY,GAGlB,CAAE,MAAOC,GACPrB,QAAQqB,MAAM,yBAA0BA,EAC1C,C,QACEjB,EAAMG,WACR,CACF,GAmGCT,OAAOI,QAAgBC,UAAU,gBA9FlCK,eAA6BJ,GAC3BJ,QAAQC,IAAI,2BAEZ,IACE,MAAMQ,EAAUX,OAAOY,QAAQD,QACzBE,EAAOF,EAAQE,KAErB,IAAKA,EAGH,OAFAX,QAAQqB,MAAM,iCACdjB,EAAMG,YAKRE,EAAQE,MAAMC,qBAAqBC,SAAS,sBAAuB,CACjEC,KAAMhB,OAAOiB,aAAaC,4BAA4BM,kBACtDJ,QAAS,6BAIX,MACMK,EADWzB,OAAOY,QAAQc,gBACRC,IAAI,2BAE5B,IAAKF,EAOH,OANAvB,QAAQqB,MAAM,yBACdZ,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,0EAEXd,EAAMG,YAIRP,QAAQC,IAAI,mBAAoBsB,GAGhC,MAAMK,EAAUjB,EAAKkB,OACrB,IAAKD,EAOH,OANA5B,QAAQqB,MAAM,2BACdZ,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,mDAEXd,EAAMG,YAIRP,QAAQC,IAAI,wBAAyB2B,GAGrC,MAAME,EAAa,8EACbC,QAAiBC,MAAM,GAAGF,iBAA2B,CACzDG,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CACnBd,OAAQA,EACRe,UAAWV,MAIf,IAAKG,EAASQ,GAAI,CAChB,MAAMlB,QAAcU,EAASS,OAE7B,MAAM,IAAIC,MAAMpB,EAAMA,OAASA,EAAMH,SAAW,sBAClD,CAEA,MAAMwB,QAAeX,EAASS,OAC9BxC,QAAQC,IAAI,2BAA4ByC,GAGxCjC,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BC,qBACtDC,QAAS,uBAAuBwB,EAAOC,WAAWC,KAAK,QACvDzB,KAAM,UACNC,YAAY,GAGhB,CAAE,MAAOC,GACPrB,QAAQqB,MAAM,6BAA8BA,GAC5CvB,OAAOY,QAAQD,QAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACpFZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,aAAaG,GAAOH,SAAW,uBAG5C,C,QACEd,EAAMG,WACR,CACF,E","sources":["webpack://outlook-email-classifier-addin/./src/commands/commands.ts"],"sourcesContent":["/**\n * Ribbon button command handlers\n */\n\nOffice.onReady(() => {\n  console.log('üìå Commands loaded');\n});\n\n/**\n * Show taskpane when ribbon button is clicked\n */\nfunction showTaskpane(event: Office.AddinCommands.Event): void {\n  Office.addin.showAsTaskpane();\n  event.completed();\n}\n\n/**\n * Quick action: Check classification status\n */\nasync function checkStatus(event: Office.AddinCommands.Event): Promise<void> {\n  try {\n    // This is a quick action that doesn't open the taskpane\n    const mailbox = Office.context.mailbox;\n    const item = mailbox.item;\n\n    if (item) {\n      // Show notification\n      mailbox.item?.notificationMessages.addAsync('status-check', {\n        type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n        message: '‚úÖ Email Classifier is active',\n        icon: 'icon-16',\n        persistent: false,\n      });\n    }\n  } catch (error) {\n    console.error('Error checking status:', error);\n  } finally {\n    event.completed();\n  }\n}\n\n/**\n * Classify current email manually\n */\nasync function classifyEmail(event: Office.AddinCommands.Event): Promise<void> {\n  console.log('üéØ classifyEmail called');\n  \n  try {\n    const mailbox = Office.context.mailbox;\n    const item = mailbox.item;\n\n    if (!item) {\n      console.error('‚ùå No email item selected');\n      event.completed();\n      return;\n    }\n\n    // Show processing notification\n    mailbox.item?.notificationMessages.addAsync('classify-processing', {\n      type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\n      message: 'ü§ñ Clasificando email...',\n    });\n\n    // Get userId from Office Roaming Settings (shared across contexts)\n    const settings = Office.context.roamingSettings;\n    const userId = settings.get('email-classifier-userId');\n    \n    if (!userId) {\n      console.error('‚ùå User not registered');\n      mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: '‚ö†Ô∏è Debes activar el clasificador primero. Abre el panel lateral.',\n      });\n      event.completed();\n      return;\n    }\n    \n    console.log('üë§ Using userId:', userId);\n\n    // Get email ID\n    const emailId = item.itemId;\n    if (!emailId) {\n      console.error('‚ùå No email ID available');\n      mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: '‚ö†Ô∏è Email no disponible para clasificaci√≥n',\n      });\n      event.completed();\n      return;\n    }\n\n    console.log('üìß Classifying email:', emailId);\n\n    // Call backend API\n    const apiBaseUrl = 'https://app-itraffic-rpa.whiteflower-4df565a8.eastus2.azurecontainerapps.io';\n    const response = await fetch(`${apiBaseUrl}/api/classify`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        userId: userId,\n        messageId: emailId,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      // Backend returns { error: '...', details: '...' }\n      throw new Error(error.error || error.message || 'Error al clasificar');\n    }\n\n    const result = await response.json();\n    console.log('‚úÖ Classification result:', result);\n\n    // Show success notification\n    mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\n      type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n      message: `‚úÖ Clasificado como: ${result.categories.join(', ')}`,\n      icon: 'icon-16',\n      persistent: false,\n    });\n\n  } catch (error: any) {\n    console.error('‚ùå Error classifying email:', error);\n    Office.context.mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\n      type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n      message: `‚ö†Ô∏è Error: ${error?.message || 'Error desconocido'}`,\n      // persistent: false is not supported for ErrorMessage\n    });\n  } finally {\n    event.completed();\n  }\n}\n\n// Register functions for ribbon buttons\n(Office.actions as any).associate('showTaskpane', showTaskpane);\n(Office.actions as any).associate('checkStatus', checkStatus);\n(Office.actions as any).associate('classifyEmail', classifyEmail);\n"],"names":["Office","onReady","console","log","actions","associate","event","addin","showAsTaskpane","completed","async","mailbox","context","item","notificationMessages","addAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","message","icon","persistent","error","ProgressIndicator","userId","roamingSettings","get","replaceAsync","ErrorMessage","emailId","itemId","apiBaseUrl","response","fetch","method","headers","body","JSON","stringify","messageId","ok","json","Error","result","categories","join"],"ignoreList":[],"sourceRoot":""}