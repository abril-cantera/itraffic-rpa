{"version":3,"file":"commands.js","mappings":"mBAIAA,OAAOC,QAAQ,KACbC,QAAQC,IAAI,wBAmIbH,OAAOI,QAAgBC,UAAU,eA7HlC,SAAsBC,GACpBN,OAAOO,MAAMC,iBACbF,EAAMG,WACR,GA2HCT,OAAOI,QAAgBC,UAAU,cAtHlCK,eAA2BJ,GACzB,IAEE,MAAMK,EAAUX,OAAOY,QAAQD,QAClBA,EAAQE,MAInBF,EAAQE,MAAMC,qBAAqBC,SAAS,eAAgB,CAC1DC,KAAMhB,OAAOiB,aAAaC,4BAA4BC,qBACtDC,QAAS,+BACTC,KAAM,UACNC,YAAY,GAGlB,CAAE,MAAOC,GACPrB,QAAQqB,MAAM,yBAA0BA,EAC1C,C,QACEjB,EAAMG,WACR,CACF,GAmGCT,OAAOI,QAAgBC,UAAU,gBA9FlCK,eAA6BJ,GAC3BJ,QAAQC,IAAI,2BAEZ,IACE,MAAMQ,EAAUX,OAAOY,QAAQD,QACzBE,EAAOF,EAAQE,KAErB,IAAKA,EAGH,OAFAX,QAAQqB,MAAM,iCACdjB,EAAMG,YAKRE,EAAQE,MAAMC,qBAAqBC,SAAS,sBAAuB,CACjEC,KAAMhB,OAAOiB,aAAaC,4BAA4BM,kBACtDJ,QAAS,6BAIX,MACMK,EADWzB,OAAOY,QAAQc,gBACRC,IAAI,2BAE5B,IAAKF,EAOH,OANAvB,QAAQqB,MAAM,yBACdZ,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,0EAEXd,EAAMG,YAIRP,QAAQC,IAAI,mBAAoBsB,GAGhC,MAAMK,EAAUjB,EAAKkB,OACrB,IAAKD,EAOH,OANA5B,QAAQqB,MAAM,2BACdZ,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,mDAEXd,EAAMG,YAIRP,QAAQC,IAAI,wBAAyB2B,GAGrC,MAAME,EAAa,8EACbC,QAAiBC,MAAM,GAAGF,iBAA2B,CACzDG,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElBC,KAAMC,KAAKC,UAAU,CACnBd,OAAQA,EACRe,UAAWV,MAIf,IAAKG,EAASQ,GAAI,CAChB,MAAMlB,QAAcU,EAASS,OAE7B,MAAM,IAAIC,MAAMpB,EAAMA,OAASA,EAAMH,SAAW,sBAClD,CAEA,MAAMwB,QAAeX,EAASS,OAC9BxC,QAAQC,IAAI,2BAA4ByC,GAGxCjC,EAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACrEZ,KAAMhB,OAAOiB,aAAaC,4BAA4BC,qBACtDC,QAAS,uBAAuBwB,EAAOC,WAAWC,KAAK,QACvDzB,KAAM,UACNC,YAAY,GAGhB,CAAE,MAAOC,GACPrB,QAAQqB,MAAM,6BAA8BA,GAC5CvB,OAAOY,QAAQD,QAAQE,MAAMC,qBAAqBc,aAAa,sBAAuB,CACpFZ,KAAMhB,OAAOiB,aAAaC,4BAA4BW,aACtDT,QAAS,aAAaG,GAAOH,SAAW,uBAG5C,C,QACEd,EAAMG,WACR,CACF,E","sources":["webpack://outlook-email-classifier-addin/./src/commands/commands.ts"],"sourcesContent":["/**\r\n * Ribbon button command handlers\r\n */\r\n\r\nOffice.onReady(() => {\r\n  console.log('üìå Commands loaded');\r\n});\r\n\r\n/**\r\n * Show taskpane when ribbon button is clicked\r\n */\r\nfunction showTaskpane(event: Office.AddinCommands.Event): void {\r\n  Office.addin.showAsTaskpane();\r\n  event.completed();\r\n}\r\n\r\n/**\r\n * Quick action: Check classification status\r\n */\r\nasync function checkStatus(event: Office.AddinCommands.Event): Promise<void> {\r\n  try {\r\n    // This is a quick action that doesn't open the taskpane\r\n    const mailbox = Office.context.mailbox;\r\n    const item = mailbox.item;\r\n\r\n    if (item) {\r\n      // Show notification\r\n      mailbox.item?.notificationMessages.addAsync('status-check', {\r\n        type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n        message: '‚úÖ Email Classifier is active',\r\n        icon: 'icon-16',\r\n        persistent: false,\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking status:', error);\r\n  } finally {\r\n    event.completed();\r\n  }\r\n}\r\n\r\n/**\r\n * Classify current email manually\r\n */\r\nasync function classifyEmail(event: Office.AddinCommands.Event): Promise<void> {\r\n  console.log('üéØ classifyEmail called');\r\n  \r\n  try {\r\n    const mailbox = Office.context.mailbox;\r\n    const item = mailbox.item;\r\n\r\n    if (!item) {\r\n      console.error('‚ùå No email item selected');\r\n      event.completed();\r\n      return;\r\n    }\r\n\r\n    // Show processing notification\r\n    mailbox.item?.notificationMessages.addAsync('classify-processing', {\r\n      type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\r\n      message: 'ü§ñ Clasificando email...',\r\n    });\r\n\r\n    // Get userId from Office Roaming Settings (shared across contexts)\r\n    const settings = Office.context.roamingSettings;\r\n    const userId = settings.get('email-classifier-userId');\r\n    \r\n    if (!userId) {\r\n      console.error('‚ùå User not registered');\r\n      mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\r\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n        message: '‚ö†Ô∏è Debes activar el clasificador primero. Abre el panel lateral.',\r\n      });\r\n      event.completed();\r\n      return;\r\n    }\r\n    \r\n    console.log('üë§ Using userId:', userId);\r\n\r\n    // Get email ID\r\n    const emailId = item.itemId;\r\n    if (!emailId) {\r\n      console.error('‚ùå No email ID available');\r\n      mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\r\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n        message: '‚ö†Ô∏è Email no disponible para clasificaci√≥n',\r\n      });\r\n      event.completed();\r\n      return;\r\n    }\r\n\r\n    console.log('üìß Classifying email:', emailId);\r\n\r\n    // Call backend API\r\n    const apiBaseUrl = 'https://app-itraffic-rpa.whiteflower-4df565a8.eastus2.azurecontainerapps.io';\r\n    const response = await fetch(`${apiBaseUrl}/api/classify`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        userId: userId,\r\n        messageId: emailId,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json();\r\n      // Backend returns { error: '...', details: '...' }\r\n      throw new Error(error.error || error.message || 'Error al clasificar');\r\n    }\r\n\r\n    const result = await response.json();\r\n    console.log('‚úÖ Classification result:', result);\r\n\r\n    // Show success notification\r\n    mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\r\n      type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n      message: `‚úÖ Clasificado como: ${result.categories.join(', ')}`,\r\n      icon: 'icon-16',\r\n      persistent: false,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('‚ùå Error classifying email:', error);\r\n    Office.context.mailbox.item?.notificationMessages.replaceAsync('classify-processing', {\r\n      type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n      message: `‚ö†Ô∏è Error: ${error?.message || 'Error desconocido'}`,\r\n      // persistent: false is not supported for ErrorMessage\r\n    });\r\n  } finally {\r\n    event.completed();\r\n  }\r\n}\r\n\r\n// Register functions for ribbon buttons\r\n(Office.actions as any).associate('showTaskpane', showTaskpane);\r\n(Office.actions as any).associate('checkStatus', checkStatus);\r\n(Office.actions as any).associate('classifyEmail', classifyEmail);\r\n"],"names":["Office","onReady","console","log","actions","associate","event","addin","showAsTaskpane","completed","async","mailbox","context","item","notificationMessages","addAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","message","icon","persistent","error","ProgressIndicator","userId","roamingSettings","get","replaceAsync","ErrorMessage","emailId","itemId","apiBaseUrl","response","fetch","method","headers","body","JSON","stringify","messageId","ok","json","Error","result","categories","join"],"ignoreList":[],"sourceRoot":""}